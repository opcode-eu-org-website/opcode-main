% BEGIN: Elektronika - Transmisja - sterowanie liniÄ…
\section{Transmisja - sterowanie liniÄ…}
\subsection{bufory}

Bufor jest to ukÅ‚ad przekazujÄ…cy sygnaÅ‚ logiczny z wejÅ›cia na wyjÅ›cie. Bufor moÅ¼e sÅ‚uÅ¼yÄ‡ do:
\begin{itemize}
\item regeneracji sygnaÅ‚u,
\item uniemoÅ¼liwieniu wprowadzenia sygnaÅ‚u z jego strony wyjÅ›ciowej na wejÅ›ciowÄ…,
\item decydowania o jego przepuszczeniu lub nie (trÃ³j-stanowy),
\item decydowania o kierunku przepuszczenia sygnaÅ‚u (dwa trÃ³j-stanowe albo trÃ³j-stanowy dwukierunkowy),
\item konwersji na liniÄ™ open-collector / open-drain,
\item negacji sygnaÅ‚u (niektÃ³re bufory realizujÄ… funkcjÄ™ NOT).
\end{itemize}

\subsection{enkodery}

Enkoder "n to m" jest to ukÅ‚ad o n wejÅ›ciach, ktÃ³ry na swoim m bitowym wyjÅ›ciu wystawia numer (typowo) wejÅ›cia o najwyÅ¼szym numerze, ktÃ³re znajduje siÄ™ w stanie niskim. MoÅ¼liwe sÄ… teÅ¼ warianty wystawiajÄ…ce numer pierwszego (a nie ostatniego) w kolejnoÅ›ci wejÅ›cia lub wybierajÄ…ce wejÅ›cie ze stanem wysokim.

Jako Å¼e wejÅ›cia numerowane sÄ… zazwyczaj od zera do 2m to ukÅ‚ad najczÄ™Å›ciej posiada dodatkowe wyjÅ›cie informujÄ…ce Å¼e ktÃ³rekolwiek z wejÅ›Ä‡ jest w stanie aktywnym. Typowo numer wystawiany jest w postaci NKB, ale moÅ¼liwe sÄ… inne kodowania.

UkÅ‚ad pozwala na redukcjÄ™ iloÅ›ci wejÅ›Ä‡ potrzebnych do obsÅ‚ugi n-bitowego sygnaÅ‚u w ktÃ³rym tylko jeden bit moÅ¼e byÄ‡ ustawiony lub w ktÃ³rym moÅ¼na pozwoliÄ‡ sobie na obsÅ‚ugÄ™ kolejnych linii z kasowaniem ich bitu (np. wektor przerwaÅ„ z priorytetyzacjÄ…).

\subsection{dekodery}

Dekoder "m to n" jest ukÅ‚adem o dziaÅ‚aniu przeciwnym do enkodera. Aktywuje on wyjÅ›cie o numerze odpowiadajÄ…cym wartoÅ›ci na m-bitowym wejÅ›ciu adresowym. Typowo posiada takÅ¼e wejÅ›cie zezwolenia na aktywacjÄ™ wyjÅ›Ä‡, ktÃ³re moÅ¼e zostaÄ‡ uÅ¼yte do podÅ‚Ä…czenia informacji Å¼e ktÃ³rekolwiek z wejÅ›Ä‡ enkodera byÅ‚o w stanie aktywnym lub do podÅ‚Ä…czenia sygnaÅ‚u danych z multipleksowanej linii celem jej demultipleksacji.

\subsection{(de)multipleksery cyfrowy}

Multiplekser cyfrowy (jednokierunkowy) na wyjÅ›cie kopiuje stan wskazanego (poprzez adres podany na wejÅ›cie adresowe) wejÅ›cia. W przypadku braku sygnaÅ‚u "enable" w zaleÅ¼noÅ›ci od rozwiÄ…zania wyjÅ›cie pozostanie w stanie niskim lub wysokiej impedancji.

Demultiplekser cyfrowy (jednokierunkowy) to zazwyczaj ukÅ‚ad dekodera w ktÃ³rym na wejÅ›cie enabled podany jest sygnaÅ‚ z multipleksowanej linii. Nie wybrane wyjÅ›cia pozostajÄ… w stanie niskim lub wysokim (zaleÅ¼nie od uÅ¼ycia nieodwracajÄ…cego lub odwracajÄ…cego dekodera). Cyfrowe demultipleksery z 3 stanowym wyjÅ›ciem sÄ… rzadkoÅ›ciÄ…. DemultipleksacjÄ™ moÅ¼na rozwiÄ…zaÄ‡ takÅ¼e przy pomocy odpowiednio sterowanych (np. z dekodera adresu) buforÃ³w trÃ³j-stanowych lub dwu-wejÅ›ciowych multiplekserÃ³w.

\subsection{(de)multipleksery analogowy}

Multiplekser analogowy (dwukierunkowy) dziaÅ‚a na zasadzie przeÅ‚Ä…cznika Å‚Ä…czÄ…cego wskazane wejÅ›cie z wyjÅ›ciem, dziÄ™ki elektrycznemu "zwarciu" (na ogÃ³Å‚ rezystancja takiego zwarcia to kilkadziesiÄ…t omÃ³w) wejÅ›cia z wyjÅ›ciem transmisja moÅ¼e odbywaÄ‡ siÄ™ w obu kierunkach. Pozwala to takÅ¼e na wykorzystanie tego samego ukÅ‚adu w roli multipleksera i demultipleksera.
% END: Elektronika - Transmisja - sterowanie liniÄ…


% BEGIN: Elektronika - Typy transmisji
\section{Typy transmisji}

WyrÃ³Å¼niÄ‡ moÅ¼na typy transmisji:
\begin{itemize}
\item \strong{simplex} -- umoÅ¼liwia tylko transmisjÄ™ jednokierunkowÄ…
\item \strong{half-duplex} -- umoÅ¼liwia transmisjÄ™ dwukierunkowÄ…, ale tylko w jednÄ… stronÄ™ rÃ³wnoczeÅ›nie
\item \strong{full-duplex} -- umoÅ¼liwia peÅ‚nÄ… transmisjÄ™ dwukierunkowÄ… (rÃ³wnoczesne nadawanie i odbiÃ³r)
\end{itemize}

\section{Magistrala rÃ³wnolegÅ‚a}

\begin{center}
    \includegraphics[width=0.85\textwidth]{img/elektronika/magistrala_rownolegla}
\end{center}
Magistrala rÃ³wnolegÅ‚a jest zespoÅ‚em linii, wraz z ukÅ‚adami nimi sterujÄ…cymi, umoÅ¼liwiajÄ…cym rÃ³wnolegÅ‚e przesyÅ‚anie danych (w jednym czasie / takcie zegara na magistrali wystawiane / przesyÅ‚ane jest caÅ‚e n-bitowe sÅ‚owo).
MoÅ¼na wyrÃ³Å¼niÄ‡ szyny sterujÄ…cÄ… (kierunek przypÅ‚ywu, Å¼Ä…dania obsÅ‚ugi, etc), adresowÄ… (adres ukÅ‚adu ktÃ³ry ma prawo nadawaÄ‡) i danych (przesyÅ‚ane dane). CzÄ™sto szyna adresowa wspÃ³Å‚dzieli linie transmisyjne z szynÄ… danych.
Do realizacji magistrali (celem umoÅ¼liwiania podÅ‚Ä…czenia wielu ukÅ‚adÃ³w) stosuje siÄ™ zazwyczaj bufory trÃ³j-stanowe, a do zapewnienia wspÃ³Å‚dzielonej szyny Å¼Ä…dania obsÅ‚ugi (interrupt request) czÄ™sto ukÅ‚ady typu open-collector.

Typowy ukÅ‚ad realizacji magistrali half-duplex ze wspÃ³Å‚dzielonymi liniami danych i adresu przestawiony zostaÅ‚ na schemacie zamieszczonym obok.
Zadaniem dekodera adresu jest ustalenie czy wystawiony na magistrali adres (w trakcie wysokiego stanu linii "Adres / Not Dane") jest adresem danego urzÄ…dzenia i zapamiÄ™tanie tej informacji do czasu wystawienia nowego adresu. Informacja ta jest wykorzystywana do sterowania dwukierunkowym buforem trÃ³j-stanowym (jako sygnaÅ‚ enable).
O kierunku dziaÅ‚ania bufora decyduje sygnaÅ‚ "Read / Not Write". Przy magistralach o ustalonym protokole transmisyjnym sterowanie kierunkiem moÅ¼e byÄ‡ zaleÅ¼ne od wykonywanej komendy (po ustawieniu adresu urzÄ…dzenie odczytuje z magistrali polecenie i w zaleÅ¼noÅ›ci od niego steruje kierunkiem bufora - odczytuje lub zapisuje dane na magistralÄ™).
Zastosowanie kilku linii typu OC do odbierania Å¼Ä…daÅ„ obsÅ‚ugi pozwala (na podstawie tego ktÃ³re z tych linii znalazÅ‚y siÄ™ w stanie niskim na identyfikacjÄ™ urzÄ…dzenia lub grupy urzÄ…dzeÅ„, z ktÃ³rej niektÃ³re zgÅ‚aszajÄ… Å¼Ä…danie obsÅ‚ugi.

W przypadku prostych urzÄ…dzeÅ„ wejÅ›cia / wyjÅ›cia zamiast buforu dwukierunkowego moÅ¼e byÄ‡ umieszczony np.
jednokierunkowy bufor (lub n-bitowy rejestr) z wyjÅ›ciami trÃ³j-stanowymi, ktÃ³ry wystawia dane na magistralÄ™ w oparciu o sygnaÅ‚ zapisu na magistralÄ™ (WR) oraz zegar (clock) albo
n-bitowy rejestr do ktÃ³rego zapisywane sÄ… dane z magistrali w oparciu o sygnaÅ‚ RD i Clock.

\section{Magistrala szeregowa}

\begin{center}
    \includegraphics[width=0.85\textwidth]{img/elektronika/magistrala_szeregowa}
\end{center}
W magistrali szeregowej dane przesyÅ‚ane sÄ… bit po bicie w pojedynczej linii. Podobnie jak w magistrali rÃ³wnolegÅ‚ej oprÃ³cz linii danych mogÄ… wystÄ™powaÄ‡ takÅ¼e linie sterujÄ…ce. ProstÄ… realizacjÄ™ magistrali szeregowej zapewniajÄ… rejestry przesuwne.

PrzykÅ‚adowy ukÅ‚ad realizacji magistrali simplex (jednokierunkowej) z rozdzielonymi szynami danych i adresowÄ… zostaÅ‚ na schemacie zamieszczonym obok.
W prezentowanym przykÅ‚adzie oprÃ³cz adresu master wystawia trzy sygnaÅ‚y - dane, zegar i strobe. Z kaÅ¼dym taktem zegara na linii danych wystawiany jest kolejny bit ktÃ³ry jest wczytywany do zespoÅ‚u rejestrÃ³w. SygnaÅ‚ strobe sÅ‚uÅ¼y do przepisania wartoÅ›ci z rejestrÃ³w przesuwnych do rejestrÃ³w wyjÅ›ciowych, takie rozwiÄ…zanie zapobiega zmianom wyjÅ›Ä‡ w trakcie przesyÅ‚ania nowych danych poprzez szynÄ™ szeregowÄ…, jest ono jednak opcjonalne.

W zaleÅ¼noÅ›ci od konstrukcji dekodera adresu szyna adresowa moÅ¼e byÄ‡ rÃ³wnolegÅ‚a (w najprostszym przypadku - przez caÅ‚Ä… transmisjÄ™ do danego urzÄ…dzenia jego adres musi byÄ‡ wystawiony na szynie a dekoder jest ukÅ‚adem bramek NOT i wielowejÅ›ciowej bramki AND) lub szeregowa (w takim wypadku powinna posiadaÄ‡ wÅ‚asny zegar lub sygnaÅ‚ informujÄ…cy o nadawaniu adresu z taktami zegara gÅ‚Ã³wnego, a dekoder powinien byÄ‡ wyposaÅ¼ony w rejestr przesuwny do odebrania i przechowywania aktualnego adresu z magistrali). Natomiast jeÅ¼eli magistrala byÅ‚aby oparta tylko na poÅ‚Ä…czonych szeregowo rejestrach (wyjÅ›cie serial-out do wejÅ›cia serial-in) to szyna adresowa nie jest potrzebna, ale konieczne moÅ¼e byÄ‡ kaÅ¼dorazowe wpisanie wszystkich wartoÅ›ci na szynÄ™ (czas zapisu roÅ›nie z iloÅ›ciÄ… podÅ‚Ä…czonych rejestrÃ³w).

\section{Standardowe interfejsy}

Istnieje wiele zestandaryzowanych interfejsÃ³w zarÃ³wno szeregowych jak i rÃ³wnolegÅ‚ych, wÅ›rÃ³d najwaÅ¼niejszych naleÅ¼y wymieniÄ‡:

\subsection{SPI (Serial Peripheral Interface)}
    jest to szeregowa magistrala full-duplex dziaÅ‚ajÄ…ca w ukÅ‚adzie master-slave zÅ‚oÅ¼ona z linii zegarowej (SCLK), nadawania przez mastera (MOSI), odbioru przez mastera (MISO) oraz linii sÅ‚uÅ¼Ä…cych do aktywacji urzÄ…dzenia slave (SS / CS). 
\subsection{I2C (TWI)}
    jest to szeregowa magistrala half-duplex zÅ‚oÅ¼ona z linii sygnaÅ‚owej (SDA) i zegara (SCL) posiadajÄ…ca zdefiniowany format ramki wraz z adresowaniem. Z wyjÄ…tkiem bitu startu i stopu stan linii danych moÅ¼e zmieniaÄ‡ siÄ™ tylko przy niskim stanie linii zegarowej.
    Nadajniki sÄ… typu open-drain przez co realizowany jest iloczyn na drucie, co pozwala na wykrywanie kolizji (jeÅ¼eli dany nadajnik nie nadaje zera a linia jest w stanie zera to nadaje takÅ¼e ktoÅ› inny). Pozwala to takÅ¼e na uzyskanie ukÅ‚adÃ³w multimaster, pomimo iÅ¼ typowo na magistrali takiej wystÄ™puje tylko jeden ukÅ‚ad master (nadajÄ…cy sygnaÅ‚ zegara i inicjujÄ…cy transmisjÄ™). 
\subsection{1 wire (one-wire)}
    jest to szeregowa magistrala half-duplex zÅ‚oÅ¼ona z jedynie z linii sygnaÅ‚owej (ktÃ³ra moÅ¼e takÅ¼e sÅ‚uÅ¼yÄ‡ do zasilania urzÄ…dzeÅ„) posiadajÄ…ca zdefiniowany format ramki wraz z adresowaniem. Standardowe nadawanie jest realizowane jako open-drain (wyjÄ…tkiem jest nadawanie tzw power-byte). 
\subsection{USART}
    jest to uniwersalny synchroniczny i asynchroniczny nadajnik i odbiornik, umoÅ¼liwia realizacjÄ™ szeregowej transmisji synchronicznej (zgodnie z zegarem) lub asynchronicznej (wykrywanie poczÄ…tku ramki na podstawie linii danych). Interfejs korzysta z rozdzielonych linii nadajnika i odbiornika (wyjÅ›cie danych TxD oraz wejÅ›cie danych RxD, co umoÅ¼liwia realizacjÄ™ transmisji full-duplex) oraz moÅ¼e korzystaÄ‡ z dodatkowych sygnaÅ‚Ã³w sterujÄ…cych (wyjÅ›cie RTS informujÄ…ce o gotowoÅ›ci do odbioru oraz wejÅ›cie CTS informacji o gotowoÅ›ci odbioru / zezwolenia na nadawanie). Niekiedy dostÄ™pne jest takÅ¼e wyjÅ›cie zaÅ‚Ä…czenia nadajnika uÅ¼ywane do pracy w trybie half-duplex (linie TxD i RxD poÅ‚Ä…czone buforem trÃ³j-stanowym nadajnika).

    Interfejs ten najczÄ™Å›ciej wykorzystywany jest w trybie asynchronicznym jako UART. W poÅ‚Ä…czeniach UART zarÃ³wno nadajnik jak i odbiornik muszÄ… mieÄ‡ ustawione takie same parametry transmisji (szybkoÅ›Ä‡, znaczenie 9 bitu (typowo bit parzystoÅ›ci, ale moÅ¼e takÅ¼e oznaczaÄ‡ np. pole adresowe), itp).
    GÅ‚Ã³wnymi standardami elektrycznymi dla UART sÄ…: poziomy napiÄ™Ä‡ ukÅ‚adÃ³w elektronicznych uÅ¼ywajÄ…cych tych portÃ³w (3.3V, 5V), RS-232 (w peÅ‚nym wariancie uÅ¼ywa sygnaÅ‚Ã³w kontroli przepÅ‚ywu, poziom logiczny 1 wynosi od -15V do -3V, a poziom logiczny 0 od +3V do +15V), RS-422 (transmisja rÃ³Å¼nicowa full-duplex pomiÄ™dzy dwoma urzÄ…dzeniami) i RS-485 (transmisja rÃ³Å¼nicowa half-duplex w oparciu o szynÄ™ Å‚Ä…czÄ…cÄ… wiele urzÄ…dzeÅ„, kompatybilny elektrycznie z RS-422), moÅ¼liwia jest teÅ¼ transmisja Å›wiatÅ‚owodowa i bezprzewodowa.
% END: Elektronika - Typy transmisji

\begin{ProTip}[breakable]{Rezystory terminujÄ…ce {\Symbola ğŸ¤”}}
NiektÃ³re  ze standardÃ³w interfejsÃ³w komunikacyjnych przewidujÄ… koÅ„czenie swoich magistral rezystorem terminujÄ…cym.
Zastosowanie takiego rezystora ma na celu eliminacjÄ™ odbiÄ‡ sygnaÅ‚u, ktÃ³re mogÅ‚yby powstaÄ‡ na koÅ„cu linii transmisyjnej.

\vspace{7pt}

Zjawisko to wystÄ™puje w przypadku \textit{linii dÅ‚ugich}, czyli takich ktÃ³rych dÅ‚ugoÅ›Ä‡ jest zbliÅ¼ona lub wiÄ™ksza od dÅ‚ugoÅ›ci fali zwiÄ…zanej z przesyÅ‚anym sygnaÅ‚em.
JeÅ¼eli rozwaÅ¼ymy np. impuls o czasie trwania 1$\mu \rm s$ to zajmie on na kablu odcinek o dÅ‚ugoÅ›ci okoÅ‚o 200m (zaleÅ¼y to od prÄ™dkoÅ›ci rozchodzenia siÄ™ fali elektromagnetycznej w oÅ›rodku ktÃ³ry stanowi dany przewÃ³d).
Zatem dla sygnaÅ‚u 1MHz (czyli takiego gdzie pojedyncze impulsy sÄ… wÅ‚aÅ›nie dÅ‚ugoÅ›ci 1$\mu \rm s$) przewÃ³d o dÅ‚ugoÅ›ci kilkuset metrÃ³w bÄ™dzie liniÄ… dÅ‚ugÄ….

\vspace{7pt}

Odbicia te wynikajÄ… z faktu, iÅ¼ przemieszczanie siÄ™ sygnaÅ‚u (np. naszego impulsu 5V o czasie trwania 1$\mu \rm s$) wzdÅ‚uÅ¼ przewodu zwiÄ…zane jest z
	Å‚adowaniem kolejnych pojemnoÅ›ci pasoÅ¼ytniczych, zwiÄ…zanych z odcinkiem przewodu do ktÃ³rego dociera sygnaÅ‚.
Dzieje siÄ™ to kosztem rozÅ‚adowania pojemnoÅ›ci odcinka przewodu ktÃ³ry sygnaÅ‚ juÅ¼ opuÅ›ciÅ‚.

W momencie gdy sygnaÅ‚ trafia na koniec przewodnika nie ma moÅ¼liwoÅ›ci rozÅ‚adowania tej pojemnoÅ›ci na kolejny odcinek przewodu, wiÄ™c Å‚adunek z niÄ… zwiÄ…zany â€rozpÅ‚ywa siÄ™ po kabluâ€ powodujÄ…c powstanie odbicia.
Odbicie takie (biegnÄ…ce od koÅ„ca przewodu w stronÄ™ nadajnika) nakÅ‚ada siÄ™ na kolejne impulsy naszego sygnaÅ‚u (biegnÄ…ce od nadajnika) i powoduje zakÅ‚Ã³cenia w ich odbiorze (interpretacji).

Zastosowanie odpowiedniego rezystora na koÅ„cu linii pozwala na rozÅ‚adowanie tej pojemnoÅ›ci (tak jakby byÅ‚ tam kolejny nieskoÅ„czenie dÅ‚ugi odcinek przewodu) i eliminacjÄ™ odbicia.
WartoÅ›Ä‡ tej rezystancji jest charakterystyczna dla danego przewodu i okreÅ›lana przez parametr nazywany \textit{impedancjÄ… falowÄ…}.

Rezystor terminujÄ…cy stanowi obciÄ…Å¼enie dla nadajnika i powinien on byÄ‡ stosowany tylko na koÅ„cach magistrali, czyli np. na ostatnich urzÄ…dzeniach podÅ‚Ä…czonych do magistrali (a nie przy kaÅ¼dym urzÄ…dzeniu do niej wÅ‚Ä…czonym).

\vspace{7pt}

JeÅ¼eli dÅ‚ugoÅ›Ä‡ linii jest duÅ¼o mniejsza (dla sygnaÅ‚Ã³w prostokÄ…tnych przyjmuje siÄ™ Å¼e okoÅ‚o 20-40 razy) od dÅ‚ugoÅ›ci odcinka jakÄ… zajmuje pojedynczy impuls (np. linia dÅ‚ugoÅ›ci 3m, dla przykÅ‚adowego sygnaÅ‚u 1MHz)
to nie ma potrzeby stosowania rezystorÃ³w terminujÄ…cych (czÄ™sto nawet gdy w ogÃ³lnoÅ›ci dany standard je przewiduje), gdyÅ¼ stan caÅ‚ej linii jest spÃ³jny i wymuszany przez nadajnik (nie jest to przypadek linii dÅ‚ugiej).

\vspace{7pt}

Standard I2C nie przewiduje rezystorÃ³w terminujÄ…cych (i nie powinny byÄ‡ w nim uÅ¼ywane, zwÅ‚aszcza Å¼e sÄ… to linie open drain i powstawaÅ‚by dzielnik z rezystorem pull-up).
Wynika to z tego iÅ¼ przy maksymalnej prÄ™dkoÅ›ci tego interfejsu za linie dÅ‚ugie naleÅ¼aÅ‚oby uznaÄ‡ odcinki co najmniej kilkunastometrowe, a z innych wzglÄ™dÃ³w standard ten posiada ograniczenie do kilku metrÃ³w.

Standard RS-485 przewiduje stosowanie rezystorÃ³w terminujÄ…cych 120 Î©, jednak w przypadku krÃ³tkich poÅ‚Ä…czeÅ„ i/lub maÅ‚ych prÄ™dkoÅ›ci transmisji mogÄ… one byÄ‡ pominiÄ™te.
\end{ProTip}
