% Copyright (c) 2018-2020 Matematyka dla Ciekawych wiata (http://ciekawi.icm.edu.pl/)
% Copyright (c) 2018-2020 Robert Ryszard Paciorek <rrp@opcode.eu.org>
% 
% MIT License
% 
% Permission is hereby granted, free of charge, to any person obtaining a copy
% of this software and associated documentation files (the "Software"), to deal
% in the Software without restriction, including without limitation the rights
% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the Software is
% furnished to do so, subject to the following conditions:
% 
% The above copyright notice and this permission notice shall be included in all
% copies or substantial portions of the Software.
% 
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
% SOFTWARE.

%  BEGIN: Zmienna, obiekt i referencja
\subsection{Zmienna, obiekt i referencja {\Symbola }}

W Pythonie ka偶da zmienna jest nazw wskazujc na jaki obiekt w pamici. Podobnie ka偶dy element listy czy sownika wskazuje na jaki obiekt\footnote{
Zasadniczo wszystkie definiowane przez nas zmienne czy funkcje s elementem sownika zwizanego z danym kontekstem.
Do sownik贸w tych mo偶na uzyska dostp poprzez funkcje \python{globals()} (sownik zawierajcy elementy zdeklarowane w kontekcie globalnym) i
\python{locals()} (sownik zawierajcy elementy zadeklarowane w kontekcie lokalnym).
}.
Na jeden obiekt mo偶e wskazywa wiele zmiennych i/lub element贸w innych obiekt贸w (takich jak listy czy sowniki).
Je偶eli zmienna nie ma na co wskazywa (np. zosta do niej przypisany wynik funkcji, kt贸ra nie zwraca wartoci) wskazuje na obiekt \python{None} (typu \python{NoneType}).
Zatem na wszystkie zmienne pythonowe mo偶emy patrze jak na referencje do obiekt贸w istniejcych gdzie w pamici.

Do uzyskania identyfikatora obiektu zwizanego z dan nazw, lub elementem innego obiektu su偶y funkcja \python{id} (w przypadku standardowej implementacji Pythona jest to po prostu adres w pamici).

\begin{teacherOnly}
Warto troch rozwin ten temat, np. bazgrzc po tablicy zmienne wskazujce na obiekty i zmieniajc/zrywajc poczania midzy zmienn a obiektem.

Warto tak偶e pokaza dziaanie wspomnianych funkcji \python{globals()} i \python{locals()} (zwr贸 uwag na r贸偶nic midzy a i b oraz c i d):
\begin{CodeFrame*}[python]{}
a, b = 0, 0

def f1():
    def f2(x):
       a = 2
       print("f2", a, c)
       print(" locals  = ", locals())
       print(" globals = ", globals())
    
    a = 1
    c, d = 3, 4
    print("f1", a)
    print(" locals  = ", locals())
    print(" globals = ", globals())
    f2(7)

f1()
\end{CodeFrame*}
\end{teacherOnly}

\subsubsection{Usuwanie i czas 偶ycia zmiennych {\Symbola }}

Instrukcja \python{del}, kt贸rej u偶ywalimy ju偶 do usuwania element贸w z listy lub sownika mo偶e by wykorzystana tak偶e do usuwania innych zmiennych.
Nale偶y jednak pamita i偶 w Pythonie usunicie zmiennej nie wi偶e si z natychmiastowym zwolnieniem zajmowanej przez ni pamici z kilku powod贸w:
\begin{itemize}
\item na pojedynczy obiekt mo偶e wskazywa kilka zmiennych
\item to Python decyduje o tym kiedy zwalnia / ponownie u偶y pami pozosta po obiektach na kt贸re nie wskazuje ju偶 偶adna nazwa
\end{itemize}

\subsubsection{Kopiowanie obiekt贸w {\Symbola }}

Python w momencie przypisania wartoci jednej zmiennej do innej nie tworzy kopii obiektu na kt贸ry wskazuje zmienna, zamiast tego przypisuje referencj do istniejcego obiektu.
Jest to szczeg贸lnie zauwa偶alne w obiektach, kt贸re mog by wewntrznie modyfikowalne (takich jak listy czy sowniki)\footnote{
Zauwa偶 偶e jedyn mo偶liwoci modyfikacji liczby czy napisu jest przypisanie wartoci wyra偶enia do zmiennej,
a dla list czy sownik贸w mo偶emy je modyfikowa bez operacji przypisania caej listy czy sownika do nowej czy tej samej zmiennej.
\teacher{
	Jest to podzia na typy "immutable" i "mutable" - te pierwsze nie s wewntrznie modyfikowalne
	(ka偶da modyfikacja odbywa si przez przypisanie, w wyniku kt贸rego pod zmienn mo偶e zosta podpity nowy obiekt).
}}:

\begin{CodeFrame}[python]{0.55\textwidth}
a = [1, 2, 3]
b = a
print(a, b, "\n", hex(id(a)), hex(id(b)))
a[1] = 0
print(a, b, "\n", hex(id(a)), hex(id(b)))
del a
print(b,    "\n", hex(id(b)))
\end{CodeFrame}
\begin{CodeFrame}{auto}
[1, 2, 3] [1, 2, 3]
 0x7f50d76b2bc8 0x7f50d76b2bc8
[1, 0, 3] [1, 0, 3]
 0x7f50d76b2bc8 0x7f50d76b2bc8
[1, 0, 3]
 0x7f50d76b2bc8
\end{CodeFrame}

Jak wida \Verb{a} i \Verb{b} posiadaj taki sam identyfikator obiektu zwracany przez funkcj \python{id},
modyfikacja \python{a[1]} wpyna na zawarto \Verb{b}, natomiast usunicie \Verb{a} nie ma wpywu na \Verb{b}
(usunlimy tylko jedn z dw贸ch referencji na wsp贸lny obiekt).
Je偶eli chcemy uzyska kopi listy lub sownika musimy skorzysta z metody \python{copy()} odpowiedniego obiektu:

\begin{CodeFrame}[python]{0.55\textwidth}
a = [1, 2, 3]
b = a.copy()
b[1] = "X"
print(a, b, "\n", hex(id(a)), hex(id(b)))
\end{CodeFrame}
\begin{CodeFrame}{auto}
[1, 2, 3] [1, 'X', 3]
 0x7f50d76b2bc8 0x7f50d57a7088
\end{CodeFrame}

Zauwa偶 偶e tak utworzone \Verb{b} ma inny identyfikator obiektu ni偶 \Verb{a}.
Nale偶y mie tak偶e na uwadze 偶e nawet argumenty funkcji przekazywane s jako referencje na obiekty a nie kopie obiekt贸w,
natomiast dopiero operacja przypisania nowej wartoci do zmiennej zwizanej z argumentem powoduje 偶e zaczyna ona wskazywa
na nowo utworzony (w wyniku wyra偶enia po prawej stronie znaku r贸wnoci) obiekt.

\begin{teacherOnly}
Mo偶na tak偶e zwr贸ci uwag na poni偶szy kod pokazujcy r贸偶nic w obsudze referencji do obiekt贸w i samych obiekt贸w "immutable" i "mutable":
\begin{CodeFrame*}[python]{}
a, b = 5, 5
print(id(a), id(b))
b = 3
print(id(a), id(b))

a, b = [1, 2, 3], [1, 2, 3]
print(id(a), id(b))
b[2] = 5
print(id(a), id(b))
b = [1, 2, 3]
print(id(a), id(b))
\end{CodeFrame*}
\end{teacherOnly}

\subsubsection{Dla jeszcze bardziej dociekliwych {\Symbola }}

Osobom jeszcze bardziej dociekliwym w temacie wntrznoci Pythona mo偶emy poleci lektur artykuu omawiajcego te zagadnienia \url{http://www.rwdev.eu/articles/objectthinking} oraz samodzielne eksperymenty.
%  END: Zmienna, obiekt i referencja
