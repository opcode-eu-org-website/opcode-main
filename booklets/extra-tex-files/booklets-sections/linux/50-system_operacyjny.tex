% Copyright (c) 2017-2020 Matematyka dla Ciekawych Åšwiata (http://ciekawi.icm.edu.pl/)
% Copyright (c) 2017-2020 Robert Ryszard Paciorek <rrp@opcode.eu.org>
% 
% MIT License
% 
% Permission is hereby granted, free of charge, to any person obtaining a copy
% of this software and associated documentation files (the "Software"), to deal
% in the Software without restriction, including without limitation the rights
% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the Software is
% furnished to do so, subject to the following conditions:
% 
% The above copyright notice and this permission notice shall be included in all
% copies or substantial portions of the Software.
% 
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
% SOFTWARE.

% BEGIN: System operacyjny - intro
\section{System operacyjny}
\begin{teacherOnly}
\begin{easylist}[itemize]
	& \textbf{proces startu}
		&& "co komputer zaczyna robiÄ‡ po wÅ‚Ä…czeniu?"
		&& zasysanie instrukcji przez procesor
		&& zaÅ‚adowanie i uruchomienie bootloadera
		&& zaÅ‚adowanie i uruchomienie jÄ…dra
		&& opcja init
	& funkcje systemu operacyjnego
		&& procesy
			&&& co to jest proces
			&&& wÄ…tki (wÄ…tek vs proces)
			&&& \textbf{szeregowanie zadaÅ„}
			&&& drzewo procesÃ³w (rodzice)
			&&& ew. algorytmy szeregowania
			&&& fork()
			&&& sygnaÅ‚y
				&&&& kill
				&&&& czy proces moÅ¼e nie umrzeÄ‡? ... pokazaÄ‡: wynik ps, wskazaÄ‡ pid bash'a, zrobiÄ‡ kill bash
				&&&& wiele rÃ³Å¼nych sygnaÅ‚Ã³w ... Ctr+C ... Ctrl+Z ... info o zakoÅ„czeniu potomka ...
		&& obsÅ‚uga plikÃ³w
			&&& wszystko jest plikiem
			&&& select(), czyli czekanie na dane ...
		&& \textbf{obsÅ‚uga dostÄ™pu do pamiÄ™ci}
			&&& pokazaÄ‡ rysujÄ…c na tablicy stronnicowanie
			&&& pamiÄ™Ä‡ wspÃ³Å‚dzielona
				&&&& problem  if a==1: a=0
				&&&& semafory
		&& obsÅ‚uga dostÄ™pu do urzÄ…dzeÅ„
			&&& interfejsy sieciowe, itd
		&& standardowe usÅ‚ugi
			&&& cron
			&&& mail
\end{easylist}
\end{teacherOnly}

System operacyjny jest programem uruchamianym po starcie komputera (co prawda nie jako pierwszym, ale zastÄ™pujÄ…cym / usuwajÄ…cym z pamiÄ™ci uruchomione wczeÅ›niej, wiÄ™c najstarszym z dziaÅ‚ajÄ…cych).
% END: System operacyjny - intro

% BEGIN: Proces uruchamiania komputera
\subsection{Proces startu}

Po otrzymaniu sygnaÅ‚u resetu (takÅ¼e przy uruchamianiu systemu - "Power-on Reset") procesor po inicjalizacji rejestrÃ³w zaczyna wykonywanie kodu znajdujÄ…cego siÄ™ pod jakimÅ› ustalonym adresem (typowo w wbudowanej lub zewnÄ™trznej pamiÄ™ci typu ROM lub Flash). W zaleÅ¼noÅ›ci od danej architektury / procesrora moÅ¼e to byÄ‡ m.in.: bezpoÅ›rednio kod programu uÅ¼ytkownika, wbudowany bootloader danego procesora umoÅ¼liwiajÄ…cy dalsze Å‚adowanie np. z karty SD, zewnÄ™trzny niskopoziomowy bootloader (np. u-boot).

W przypadku architektur zgodnych z x86 jest to BIOS, ktÃ³ry po zakoÅ„czeniu procesu inicjalizacji sprzÄ™tu i testÃ³w rozruchowych Å‚aduje do pamiÄ™ci kod znajdujÄ…cy siÄ™ w pierwszym sektorze dysku twardego (sektorze rozruchowym rozpoczynajÄ…cym siÄ™ od adresu zerowego) i uruchamia go (przekazuje do niego kontrolÄ™). Znajduje siÄ™ tam kod (lub tylko poczÄ…tek kodu) programu rozruchowego, ktÃ³rego zadaniem jest zaÅ‚adowanie systemu operacyjnego. W przypadku wspÃ³Å‚czesnych systemÃ³w linuxowych jest to zazwyczaj GRUB.

Start systemu rozpoczyna siÄ™ od zaÅ‚adowania do pamiÄ™ci obrazu jÄ…dra wraz z parametrami oraz (opcjonalnie) initrd i przekazania kontroli do jÄ…dra przez program rozruchowy (np. GRUB). W przypadku jÄ…dra linuxowego i korzystania z initrd obraz ten przeksztaÅ‚cany jest na RAM-dysk w trybie zapisu-odczytu i montowany jako rootfs z ktÃ³rego uruchamiany jest \Verb#/sbin/init# (ktÃ³rego podstawowym zadaniem jest zamontowanie wÅ‚aÅ›ciwego rootfs). Po jego zakoÅ„czeniu (lub od razu gdy nie uÅ¼ywamy initrd) uruchamiany jest program wskazany w opcji \Verb#init=# jÄ…dra (domyÅ›lnie typowo \Verb#/sbin/init#) z rootfs wskazanego w opcji \Verb#root=# jÄ…dra. W opcji \Verb#init=# moÅ¼na wskazaÄ‡ dowolny program lub skrypt (uruchomiony zostanie z prawami root'a).
% END: Proces uruchamiania komputera

% BEGIN: Co robi system operacyjny
\subsection{Rola systemu operacyjnego}

System operacyjny jest oprogramowaniem odpowiedzialnym za zarzÄ…dzanie zasobami systemu komputerowego (sprzÄ™tem, ale nie tylko) oraz uruchomionymi na nim aplikacjami. Do najistotniejszych zadaÅ„ systemu operacyjnego zalicza siÄ™ podziaÅ‚ czasu procesora i szeregowanie zadaÅ„ oraz zarzÄ…dzanie pamiÄ™ciÄ… - w szczegÃ³lnoÅ›ci obsÅ‚uga pamiÄ™ci wirtualnej, najczÄ™Å›ciej z wykorzystaniem mechanizmu stronicowania.

OprÃ³cz tego system zajmuje siÄ™ takÅ¼e zarzÄ…dzaniem plikami, wejÅ›ciem/wyjÅ›ciem (najczÄ™Å›ciej jest ono realizowane w oparciu o przerwania (IRQ), ale znane sÄ… takÅ¼e modele programowego we/wy polegajÄ…cego na aktywnym czekaniu), obsÅ‚ugÄ… urzÄ…dzeÅ„ (wejÅ›cie/wyjÅ›cie, sterowniki, dostÄ™p), obsÅ‚ugÄ… sieci (stos protokoÅ‚Ã³w sieciowych), itd.

WspÃ³Å‚czesne systemy korzystajÄ… z co najmniej dwÃ³ch poziomÃ³w pracy - uprzywilejowanego poziomu "nadzorcy" w ktÃ³rym dziaÅ‚a jÄ…dro systemu operacyjnego oraz trybu uÅ¼ytkownika. Operacje I/O muszÄ… odbywaÄ‡ siÄ™ w trybie uprzywilejowanym. RÃ³wnieÅ¼ pamiÄ™Ä‡ posiada obszar chroniony, w ktÃ³rym umieszczany jest m.in. tablica wektorÃ³w przerwaÅ„ (inaczej zmiana adresu w tym wektorze mogÅ‚aby doprowadziÄ‡ do przejÄ™cia systemu w trybie uprzywilejowanym).
% END: Co robi system operacyjny

% BEGIN: ZarzÄ…dzanie procesami
\subsubsection{ZarzÄ…dzanie procesami}

Jednym z gÅ‚Ã³wnych zadaÅ„ systemu operacyjnego jest zarzÄ…dzanie procesami na nim uruchomionymi - obejmuje to zarÃ³wno czynnoÅ›ci zwiÄ…zane z ich tworzeniem oraz koÅ„czeniem, jak teÅ¼ szeregowanie zadaÅ„. To system operacyjny przejmuje okresowo procesor (z uÅ¼yciem przerwania zegarowego), aby podjÄ…Ä‡ decyzjÄ™ (w oparciu o jakiÅ› algorytm szeregowania zadaÅ„) ktÃ³ry/ktÃ³re z porcesÃ³w gotowych do dziaÅ‚ania (czyli takich, ktÃ³re aktualnie nie oczekujÄ… na "coÅ›") ma dostaÄ‡ przydziaÅ‚ czasu porcesora.
% END: ZarzÄ…dzanie procesami

% BEGIN: ZarzÄ…dzanie pamiÄ™ciÄ…
\subsubsection{ZarzÄ…dzanie pamiÄ™ciÄ…}

DrugÄ… podstawowÄ… funkcjÄ… systemu operacyjnego, wspomnianÄ… na poczÄ…tku, jest zarzÄ…dzanie pamiÄ™ciÄ…. ZarzÄ…dzanie pamiÄ™ciÄ… polega na odpowiednim mapowaniu adresÃ³w logicznych (uÅ¼ywanych przez procesy) na adresy fizyczne (uÅ¼ywane przez procesor), korzysta ono z wsparcia sprzÄ™towego ze strony procesora.

Jest to najczÄ™Å›ciej realizowane w oparciu o wspomniany mechanizm stronicowania. Polega to na podziale pamiÄ™ci dostÄ™pnej pamiÄ™ci fizycznej na jednakowe bloki zwane ramkami oraz podziale pamiÄ™ci logicznej na jednakowe bloki (o tej caÅ‚ej wielkoÅ›ci co ramki) zwane stronami. Strony ktÃ³re sÄ… wykorzystywane przez program sÄ… mapowane na dowolne ramki pamiÄ™ci fizycznej (w przypadku gdy dana strona nie zamapowana - w zaleÅ¼noÅ›ci od okolicznoÅ›ci bÅ‚Ä…d braku strony lub bÅ‚Ä…d ochrony strony).

RozwiÄ…zuje to problem fragmentacji zewnÄ™trznej, polegajÄ…cej na braku spÃ³jnego obszaru pamiÄ™ci o Å¼Ä…danej dÅ‚ugoÅ›ci pomimo iÅ¼ Å‚Ä…czna iloÅ›Ä‡ wolnej pamiÄ™ci jest dostateczna, jednak nie rozwiÄ…zuje problemu fragmentacji wewnÄ™trznej, polegajÄ…cej na przydzielaniu zbyt duÅ¼ych fragmentÃ³w pamiÄ™ci dla procesu (a wrÄ™cz moÅ¼na powiedzieÄ‡ Å¼e go pogÅ‚Ä™bia).

Mechanizm ten wymaga trzymania tablicy wolnych ramek, tablicy stron dla kaÅ¼dego procesu (zawierajÄ…cej przypisania mapowaÅ„ stron danego procesu na ramki) oraz wykonywania tÅ‚umaczenia adresÃ³w logicznych (strona + przesuniÄ™cie na stronie). TakÅ¼e sama tablica stron procesu procesu moÅ¼e byÄ‡ stronicowania (mamy tablicÄ™ ktÃ³ra informuje nas Å¼e przypisania stron w danym zakresie adresÃ³w sÄ… przechowywane w jakiejÅ› ramce).

Strony i ramki mogÄ… byÄ‡ wspÃ³Å‚dzielone pomiÄ™dzy procesami (np. przy rozgaÅ‚Ä™zianiu procesu strony sÄ… kopiowane dopiero gdy zajdzie taka potrzeba). W przypadku braku miejsca w pamiÄ™ci fizycznej wybrane strony nieaktywnego aktualnie procesu mogÄ… byÄ‡ umieszczane na dysku (swap).
% END: ZarzÄ…dzanie pamiÄ™ciÄ…

\subsubsection{Literatura dodatkowa {\Symbola ğŸ¤”}}

ByÅ‚o to bardzo krÃ³tkie i elementarne wprowadzenie w bardzo obszerny temat jakim sÄ… \textit{systemy operacyjne}. Wszystkich zainteresowanym niskopoziomowym dziaÅ‚aniem systemu operacyjnego zachÄ™camy do zapoznania siÄ™ z \href{https://pl.wikibooks.org/wiki/Pisanie_OS}{kursem pisania OS}\footnote{\url{https://pl.wikibooks.org/wiki/Pisanie_OS}} â€“ niekoniecznie od razu pisania wÅ‚asnego systemu operacyjnego, ale przynajmniej zobaczeniem jak to siÄ™ robi.
